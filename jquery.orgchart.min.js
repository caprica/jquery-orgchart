/**
 * JQuery Organisation Chart Plugin.
 *
 * Author: Mark Lee
 * Copyright (C)2013 Caprica Software Limited 
 * http://www.capricasoftware.co.uk
 * 
 * Contributions by: Paul Lautman <paul.lautman at gmail.com>
 *
 * This software is licensed under the Creative Commons Attribution-ShareAlike 3.0 License,
 * see here for license terms:
 *
 *     http://creativecommons.org/licenses/by-sa/3.0
 */
(function(a){function m(b,e,f,c){var n=a("<table cellpadding='0' cellspacing='0' border='0'/>"),h=a("<tbody/>"),l=a("<tr/>").addClass("nodes"),g=a("<td/>").addClass("node").attr("colspan",2),d=b.children("ul:first").children("li");1<d.length&&g.attr("colspan",2*d.length);var j=a("<h2>").html(c.nodeText(b));$nodeDiv=a("<div>").addClass("node").addClass("level"+f).data("orgchart-level",f).data("orgchart-node",b).append(j);c.copyClasses&&$nodeDiv.addClass(b.attr("class"));g.append($nodeDiv);l.append(g);
h.append(l);$nodeDiv.click(function(){var d=a(this);c.nodeClicked(d.data("orgchart-node"));if(c.interactive){var b=d.closest("tr");b.next("tr").is(":visible")?(c.fade?b.nextAll("tr").fadeOut(c.speed):b.nextAll("tr").hide(),d.removeClass("shownChildren").addClass("hiddenChildren")):(d.removeClass("hiddenChildren").addClass("shownChildren"),c.fade?b.nextAll("tr").fadeIn(c.speed):b.nextAll("tr").show())}});if(0<d.length){if(-1==c.depth||f+1<c.depth){b=a("<tr/>").addClass("lines");g=a("<td/>").attr("colspan",
2*d.length);b.append(g);j=a("<table cellpadding='0' cellspacing='0' border='0'>");j.append("<tbody>");var p=a("<tr/>").addClass("lines x"),r=a("<td>").addClass("line left"),s=a("<td>").addClass("line right");p.append(r).append(s);j.children("tbody").append(p);g.append(j);h.append(b);0<d.length&&($nodeDiv.addClass("hasChildren"),-1==c.showLevels||f<c.showLevels-1?$nodeDiv.addClass("shownChildren"):$nodeDiv.addClass("hiddenChildren"),c.interactive&&$nodeDiv.hover(function(){a(this).addClass(c.hoverClass)},
function(){a(this).removeClass(c.hoverClass)}));var k=a("<tr/>").addClass("lines v");d.each(function(){var c=a("<td/>").addClass("line left top"),b=a("<td/>").addClass("line right top");k.append(c).append(b)});k.find("td:first").removeClass("top");k.find("td:last").removeClass("top");h.append(k);var q=a("<tr/>");d.each(function(){var b=a("<td/>");b.attr("colspan",2);m(a(this),b,f+1,c);q.append(b)})}else c.stack&&(d=d.clone(),d=a("<ul class='stack'>").append(d),$nodeDiv.after(d));h.append(q)}-1<c.showLevels&&
f>=c.showLevels-1&&l.nextAll("tr").hide();n.append(h);e.append(n)}a.fn.orgChart=function(b){var e=a.extend({},a.fn.orgChart.defaults,b);return this.each(function(){$this=a(this).clone();-1<e.levels&&$this.find("ul").andSelf().filter(function(){return a(this).parents("ul").length+1>e.levels}).remove();var b=a("<div class='"+e.chartClass+"'/>");e.interactive&&b.addClass("interactive");$this.is("ul")&&m($this.find("li:first"),b,0,e);b.find("div.node a").click(function(a){a.stopImmediatePropagation()});
e.container.append(b)})};a.fn.orgChart.defaults={container:a("body"),depth:-1,levels:-1,showLevels:-1,stack:!1,chartClass:"orgChart",hoverClass:"hover",nodeText:function(a){return a.clone().children("ul,li").remove().end().html()},interactive:!1,fade:!1,speed:"slow",nodeClicked:function(){},copyClasses:!0}})(jQuery);
